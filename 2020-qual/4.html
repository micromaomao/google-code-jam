<!DOCTYPE html><html><head><meta charset="utf8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="../commons/style.css"><script src="../commons/general.js" async></script><title>2020-qual Problem D - Mao's Google Code Jam practice files</title><link rel="stylesheet" href="../commons/hljs.css"></head><body><a class="toroot" href="..">Return to problem list</a><h1>2020-qual Problem D</h1><h2>Final solution</h2><div class="filehead"><div class="fnamecontain"><a class="fname" href="files/main.rs" target="_blank">main.rs</a>:</div><a class="download" href="files/main.rs" title="Download original" download="main.rs">save</a>&nbsp;&nbsp;&nbsp;<a class="openongithub" href="https://github.com/micromaomao/google-code-jam/blob/master/2020-qual/4/main.rs" target="_blank">open on GitHub</a></div><pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">test</span></span>(b: <span class="hljs-built_in">usize</span>) -&gt; <span class="hljs-built_in">bool</span> {
	<span class="hljs-built_in">assert!</span>(b % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>);

	<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">make_query</span></span>(i: <span class="hljs-built_in">usize</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;<span class="hljs-built_in">u8</span>&gt; {
		<span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, i + <span class="hljs-number">1</span>);
		<span class="hljs-keyword">let</span> ans = read_line();
		<span class="hljs-keyword">match</span> &amp;ans[..] {
			<span class="hljs-string">"0"</span> =&gt; <span class="hljs-literal">Some</span>(<span class="hljs-number">0u8</span>),
			<span class="hljs-string">"1"</span> =&gt; <span class="hljs-literal">Some</span>(<span class="hljs-number">1u8</span>),
			_ =&gt; <span class="hljs-literal">None</span>
		}
	}

	<span class="hljs-built_in">macro_rules!</span> unwrap_or_ret {
		($e:expr) =&gt; {{
			<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(r) = $e {
				r
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}
		}};
	}

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> arr: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">Option</span>&lt;<span class="hljs-built_in">u8</span>&gt;&gt; = <span class="hljs-built_in">vec!</span>[<span class="hljs-literal">None</span>; b];
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> first_different_pair: <span class="hljs-built_in">Option</span>&lt;(<span class="hljs-built_in">usize</span>, <span class="hljs-built_in">usize</span>)&gt; = <span class="hljs-literal">None</span>;
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> first_same_pair: <span class="hljs-built_in">Option</span>&lt;(<span class="hljs-built_in">usize</span>, <span class="hljs-built_in">usize</span>)&gt; = <span class="hljs-literal">None</span>;
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> next_query_no = <span class="hljs-number">1usize</span>;
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> ptr_l = <span class="hljs-number">0usize</span>;
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> ptr_r = b - <span class="hljs-number">1</span>;

	<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">invert_arr</span></span>(arr: &amp;<span class="hljs-keyword">mut</span> [<span class="hljs-built_in">Option</span>&lt;<span class="hljs-built_in">u8</span>&gt;]) {
		<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..arr.len() {
			<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(ai) = arr[i] {
				<span class="hljs-built_in">assert!</span>(ai &lt; <span class="hljs-number">2</span>);
				arr[i] = <span class="hljs-literal">Some</span>(<span class="hljs-number">1</span> - ai);
			}
		}
	}

	<span class="hljs-built_in">macro_rules!</span> query {
		($i:expr) =&gt; {{
			next_query_no += <span class="hljs-number">1</span>;
			unwrap_or_ret!(make_query($i))
		}};
	}

	<span class="hljs-keyword">while</span> ptr_l &lt; ptr_r {
		<span class="hljs-keyword">if</span> next_query_no != <span class="hljs-number">1</span> &amp;&amp; next_query_no % <span class="hljs-number">10</span> == <span class="hljs-number">1</span> {
			<span class="hljs-keyword">if</span> first_same_pair.is_none() || first_different_pair.is_none() {
				<span class="hljs-comment">// first_same_pair.is_none(): reverse and invert is the same in this case, hence we can assume either invert or no invert.</span>
				<span class="hljs-comment">// first_different_pair.is_none(): reverse has no effect. check for invert.</span>
				<span class="hljs-keyword">if</span> query!(<span class="hljs-number">0</span>) != arr[<span class="hljs-number">0</span>].unwrap() {
					invert_arr(&amp;<span class="hljs-keyword">mut</span> arr);
				}
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">let</span> same_i = first_same_pair.unwrap().<span class="hljs-number">0</span>;
				<span class="hljs-keyword">let</span> same_orig = arr[same_i].unwrap();
				<span class="hljs-keyword">if</span> query!(same_i) != same_orig {
					<span class="hljs-comment">// reverse can't achieve this. hence must be invert.</span>
					invert_arr(&amp;<span class="hljs-keyword">mut</span> arr);
				}

				<span class="hljs-keyword">let</span> diff_i = first_different_pair.unwrap().<span class="hljs-number">0</span>;
				<span class="hljs-keyword">let</span> diff_orig = arr[diff_i].unwrap();
				<span class="hljs-comment">// invert has been fixed now, so only reverse possible.</span>
				<span class="hljs-keyword">if</span> query!(diff_i) != diff_orig {
					arr.reverse();
				}
			}
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">let</span> i = ptr_l;
			<span class="hljs-keyword">let</span> j = ptr_r;
			<span class="hljs-keyword">if</span> (next_query_no + <span class="hljs-number">1</span>) % <span class="hljs-number">10</span> == <span class="hljs-number">1</span> {
				<span class="hljs-comment">// to not break invarient, we waste a dummy query.</span>
				query!(<span class="hljs-number">0</span>);
				<span class="hljs-keyword">continue</span>;
			}
			<span class="hljs-built_in">assert_eq!</span>(arr[i], <span class="hljs-literal">None</span>);
			<span class="hljs-built_in">assert_eq!</span>(arr[j], <span class="hljs-literal">None</span>);
			arr[i] = <span class="hljs-literal">Some</span>(query!(i));
			arr[j] = <span class="hljs-literal">Some</span>(query!(j));
			<span class="hljs-keyword">if</span> first_different_pair.is_none() &amp;&amp; arr[i].unwrap() != arr[j].unwrap() {
				first_different_pair = <span class="hljs-literal">Some</span>((i, j));
			}
			<span class="hljs-keyword">if</span> first_same_pair.is_none() &amp;&amp; arr[i].unwrap() == arr[j].unwrap() {
				first_same_pair = <span class="hljs-literal">Some</span>((i, j));
			}
			ptr_l += <span class="hljs-number">1</span>;
			ptr_r -= <span class="hljs-number">1</span>;
		}
	}
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> res = <span class="hljs-built_in">String</span>::with_capacity(b);
	<span class="hljs-keyword">for</span> it <span class="hljs-keyword">in</span> arr {
		res.push(<span class="hljs-keyword">match</span> it.unwrap() {
			<span class="hljs-number">0</span> =&gt; <span class="hljs-string">'0'</span>,
			<span class="hljs-number">1</span> =&gt; <span class="hljs-string">'1'</span>,
			_ =&gt; <span class="hljs-built_in">unreachable!</span>()
		});
	}
	<span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, &amp;res);
	&amp;read_line() == <span class="hljs-string">"Y"</span>
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
	<span class="hljs-keyword">let</span> (t, b) = {
		<span class="hljs-keyword">let</span> l = read_ints();
		<span class="hljs-built_in">assert_eq!</span>(l.len(), <span class="hljs-number">2</span>);
		(l[<span class="hljs-number">0</span>], l[<span class="hljs-number">1</span>])
	};
	<span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..t {
		<span class="hljs-keyword">if</span> !test(b) {
			<span class="hljs-keyword">return</span>;
		}
	}
}

<span class="hljs-comment">// boilerplate omitted...</span></code></pre></body></html>